<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/contest/ContestUpload1.css">
    <title>Document</title>
</head>

<body>
<div class="container">
    <h1>ì˜ˆì‚°ì€ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?</h1>
    <form action="/contest1" method="post" enctype="multipart/form-data">
        <h2>ì½˜í…ŒìŠ¤íŠ¸ ì œëª©</h2>
        <div class="contest-title">
            <input type="text" id="conTitle" name="conTitle" placeholder="ì½˜í…ŒìŠ¤íŠ¸ ì œëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”." value="" maxlength="40" required>
        </div>

        <h2>ìƒê¸ˆ ì„¤ì •</h2>
        <p class="description">2ëª… ì´ìƒì˜ 1ë“± ì‘í’ˆì„ ì„ ì •í•˜ê±°ë‚˜, 3ë“±ê¹Œì§€ ì‘í’ˆì„ ì„ ì •í•˜ëŠ” ì½˜í…ŒìŠ¤íŠ¸ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p>

        <div id="prizeContainer">
            <!-- 1ë“± í•„ë“œ (ê³ ì •) -->
            <div class="flex-container" data-index="1">
                <div class="rank first">
                    <span>ğŸ† 1ë“±</span>
                </div>
                <div class="winners">
                    <input type="number" id="conFirstPeople" name="conFirstPeople" min="1" value="1" required>
                </div>
                <span class="label-text">ëª…</span>
                <div class="prize">
                    <input type="number" id="conFirstPrice" name="conFirstPrice" min="0" step="5" value="35" required>
                </div>
                <span class="label-text">ë§Œì›</span>
                <div class="remove-btn-container"></div>
            </div>

            <!-- ë™ì ìœ¼ë¡œ ì¶”ê°€ë  2ë“± ë° 3ë“± í•„ë“œ ì˜ì—­ -->
            <div id="dynamicPrizes"></div>
        </div>

        <button type="button" class="btn-secondary" onclick="addPrize()">ë“±ìˆ˜ ì¶”ê°€í•˜ê¸°</button>

        <div class="total-prize">
            <span>ğŸ† ì´ ìƒê¸ˆ <span id="totalPrize">35</span> ë§Œì›</span>
        </div>

        <div class="date-settings">
            <h2>ê°œìµœ ê¸°ê°„ ì„¤ì • *</h2>
            <div class="flex-container">
                <div>
                    <label for="conStartDate">ì‹œì‘ ë‚ ì§œ</label>
                    <input type="date" id="conStartDate" name="conStartDate" required>
                </div>
                <div>
                    <label for="conEndDate">ì¢…ë£Œ ë‚ ì§œ</label>
                    <input type="date" id="conEndDate" name="conEndDate" required>
                </div>
            </div>
        </div>

        <div class="flex-buttons">
            <button type="button" class="btn previous-btn" onclick="history.back()">ì´ì „</button>
            <button type="submit" class="btn">ë‹¤ìŒ</button>
        </div>
    </form>
</div>
</body>

<script>
    let prizeIndex = 2; // 2ë“±ë¶€í„° ì‹œì‘

    function addPrize() {
        if (prizeIndex > 3) {
            alert("3ë“±ê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            return;
        }

        const prizeContainer = document.getElementById('dynamicPrizes');

        // ìƒˆë¡œìš´ ë“±ìˆ˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” div ìƒì„±
        const newPrize = document.createElement('div');
        newPrize.className = 'flex-container';
        newPrize.setAttribute('data-index', prizeIndex);

        // ë“±ìˆ˜ì— ë§ëŠ” ì•„ì´ì½˜ ë° í…ìŠ¤íŠ¸ ì„¤ì •
        let rankIcon = `ğŸ… ${prizeIndex}ë“±`;
        let peopleName = '', priceName = '';

        if (prizeIndex === 2) {
            rankIcon = `ğŸ¥ˆ 2ë“±`;
            peopleName = 'conSecondPeople';  // ê³ ì •ëœ name ê°’
            priceName = 'conSecondPrice';    // ê³ ì •ëœ name ê°’
        } else if (prizeIndex === 3) {
            rankIcon = `ğŸ¥‰ 3ë“±`;
            peopleName = 'conThirdPeople';   // ê³ ì •ëœ name ê°’
            priceName = 'conThirdPrice';     // ê³ ì •ëœ name ê°’
        }

        // ìƒˆ ë“±ìˆ˜ í•„ë“œì— HTML ì¶”ê°€
        newPrize.innerHTML = `
            <div class="rank">
                <span>${rankIcon}</span>
            </div>
            <div class="winners">
                <input type="number" id="${peopleName}" name="${peopleName}" min="1" value="1" required>
            </div>
            <span class="label-text">ëª…</span>
            <div class="prize">
                <input type="number" id="${priceName}" name="${priceName}" min="0" step="5" value="20" required>
            </div>
            <span class="label-text">ë§Œì›</span>
            <div class="remove-btn-container">
                <button type="button" class="remove-btn" onclick="removePrize(this)">âœ–</button>
            </div>
        `;

        // ìƒˆ í•„ë“œë¥¼ prizeContainerì— ì¶”ê°€
        prizeContainer.appendChild(newPrize);

        // ë“±ìˆ˜ ì¦ê°€
        prizeIndex++;
        updateTotalPrize();
    }

    function removePrize(element) {
        element.parentElement.parentElement.remove();
        prizeIndex--;
        updateTotalPrize();
    }

    function updateTotalPrize() {
        let totalPrize = 0;

        // 1ë“± ìƒê¸ˆ ê³„ì‚°: ì‚¬ëŒ ìˆ˜ * ìƒê¸ˆ
        const firstPeople = parseInt(document.getElementById('conFirstPeople').value || 0);
        const firstPrize = parseInt(document.getElementById('conFirstPrice').value || 0);
        totalPrize += firstPeople * firstPrize;

        // ë™ì ìœ¼ë¡œ ì¶”ê°€ëœ 2ë“±, 3ë“± ìƒê¸ˆ ê³„ì‚°: ì‚¬ëŒ ìˆ˜ * ìƒê¸ˆ
        const dynamicPrizes = document.querySelectorAll('#dynamicPrizes .flex-container');
        dynamicPrizes.forEach(prize => {
            const people = parseInt(prize.querySelector('input[name$="People"]').value || 0);
            const prizeAmount = parseInt(prize.querySelector('input[name$="Price"]').value || 0);
            totalPrize += people * prizeAmount;
        });

        // ì´ ìƒê¸ˆ í‘œì‹œ
        document.getElementById('totalPrize').textContent = totalPrize;
    }


    // ìƒê¸ˆ í•„ë“œ ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì´ ìƒê¸ˆ ì—…ë°ì´íŠ¸
    document.addEventListener('input', function(event) {
        if (event.target.name.includes("Price") || event.target.name.includes("People")) {
            updateTotalPrize();
        }
    });

    // í˜„ì¬ ë‚ ì§œë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    function getToday() {
        const today = new Date();
        const year = today.getFullYear();
        const month = ('0' + (today.getMonth() + 1)).slice(-2); // ì›”ì€ 0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ +1
        const day = ('0' + today.getDate()).slice(-2);
        return `${year}-${month}-${day}`;
    }

    // ì‹œì‘ ë‚ ì§œ ê¸°ë³¸ê°’ì„ í˜„ì¬ ë‚ ì§œë¡œ ì„¤ì •
    const startDateInput = document.getElementById('conStartDate');
    startDateInput.value = getToday();
    startDateInput.min = getToday(); // ì‹œì‘ ë‚ ì§œëŠ” í˜„ì¬ ë‚ ì§œ ì´í›„ì—¬ì•¼ í•¨

    // ì¢…ë£Œ ë‚ ì§œ ê¸°ë³¸ê°’ì„ ì‹œì‘ ë‚ ì§œë¡œë¶€í„° 7ì¼ ë’¤ë¡œ ì„¤ì •
    const endDateInput = document.getElementById('conEndDate');
    function setEndDate() {
        const startDate = new Date(startDateInput.value);
        const endDate = new Date(startDate);
        endDate.setDate(startDate.getDate() + 7); // 7ì¼ ë’¤ë¡œ ì„¤ì •

        const year = endDate.getFullYear();
        const month = ('0' + (endDate.getMonth() + 1)).slice(-2);
        const day = ('0' + endDate.getDate()).slice(-2);

        endDateInput.value = `${year}-${month}-${day}`;
        endDateInput.min = `${year}-${month}-${day}`; // ì¢…ë£Œ ë‚ ì§œëŠ” ì‹œì‘ ë‚ ì§œ + 7ì¼ ì´í›„ì—¬ì•¼ í•¨
    }

    // ì‹œì‘ ë‚ ì§œê°€ ë³€ê²½ë˜ë©´ ì¢…ë£Œ ë‚ ì§œë¥¼ ë‹¤ì‹œ ì„¤ì •
    startDateInput.addEventListener('change', setEndDate);

    // ì´ˆê¸° í˜¸ì¶œ: í˜ì´ì§€ ë¡œë“œ ì‹œ ì¢…ë£Œ ë‚ ì§œ ì„¤ì •
    setEndDate();

</script>

</script>

</html>
